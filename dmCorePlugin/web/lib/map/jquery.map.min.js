/* jQuery Map Plugin
 * Version 0.5
 * Author Abel Mohler
 * Developed for Kukio July 2009
 * Released with the MIT License: http://www.opensource.org/licenses/mit-license.php
 */
(function(a){a.fn.mapbox=function(c,i){var e={zoom:true,pan:true,defaultLayer:0,layerSplit:4,mapContent:".mapcontent",defaultX:null,defaultY:null,callBefore:function(n,m,l,k){},callAfter:function(n,m,l,k){},beforeZoom:function(n,m,l,k){},afterZoom:function(n,m,l,k){},mousewheel:false};if(typeof i=="function"){c.callAfter=i}var d;if(typeof c=="string"){d=c}c=a.extend(e,c||{});a(this).css({overflow:"hidden",position:"relative"});function h(o){if(!c.zoom){return}if(o===0){return}else{o=o||1}var s=a(this).find(">div"),C=s.length-1,A=a(this).find(".current-map-layer");if(typeof c.beforeZoom=="function"){c.beforeZoom(A[0],this.xPos,this.yPos,this)}var B=this.visible,G=B;B+=(o/c.layerSplit);if(B<0){B=0}if(B>C){B=C}G=Math.ceil(B);this.visible=B;var y=A.width(),u=A.height();var k=((a(this).width()/2)+this.xPos)/y,x=((a(this).height()/2)+this.yPos)/u;if(c.layerSplit>1&&G>0){var l=B-(G-1),w=s.eq(G)[0].defaultWidth,v=s.eq(G)[0].defaultHeight,r=s.eq(G-1).width(),q=s.eq(G-1).height();var p=w-r,n=v-q,m=r+(p*l),D=q+(n*l);s.eq(G).width(m).find(".map-layer-mask").width(m).height(D);s.eq(G).height(D).find(c.mapContent).width(m).height(D)}var z=(s.eq(G).width()*k)-(a(this).width()/2),t=(s.eq(G).height()*x)-(a(this).height()/2);z=0-z;t=0-t;var F=a(this).width()-s.eq(G).width(),E=a(this).height()-s.eq(G).height();if(z>0){z=0}if(t>0){t=0}if(z<F){z=F}if(t<E){t=E}this.xPos=0-z;this.yPos=0-t;s.removeClass("current-map-layer").hide();s.eq(G).css({left:z+"px",top:t+"px",display:"block"}).addClass("current-map-layer");if(typeof c.afterZoom=="function"){c.afterZoom(s.eq(G)[0],this.xPos,this.yPos,this)}}function j(t,s,o){o=o||a(this).find(".current-map-layer");var m=0,l=0,p=a(this).width(),q=a(this).height(),u=a(o).width(),k=a(o).height();if(p<u){m=p-u}if(q<k){l=q-k}var n=0-(this.xPos+t),r=0-(this.yPos+s);n=(n>0)?0:n;n=(n<m)?m:n;r=(r>0)?0:r;r=(r<l)?l:r;this.xPos=0-n;this.yPos=0-r;a(o).css({left:n+"px",top:r+"px"})}function g(k,o,l){l=l||a(this).find(".current-map-layer");k=0-k;o=0-o;var n=0-(a(l).width()-a(this).width());var m=0-(a(l).height()-a(this).height());if(k>0){k=0}if(o>0){o=0}if(k<n){k=n}if(o<m){o=m}this.xPos=0-k;this.yPos=0-o;a(l).css({left:k+"px",top:o+"px"})}function f(k){k=k.replace(/px/,"");k=0-k;return k}var b={zoom:function(k){k=k||1;h.call(this,k)},back:function(k){k=k||1;h.call(this,0-k)},left:function(k){k=k||10;j.call(this,0-k,0)},right:function(k){k=k||10;j.call(this,k,0)},up:function(k){k=k||10;j.call(this,0,0-k)},down:function(k){k=k||10;j.call(this,0,k)},center:function(l){l=l||{x:a(this).find(".current-map-layer").width()/2,y:a(this).find(".current-map-layer").height()/2};var k=a(this).find(".current-map-layer");var n=l.x-(a(this).width()/2),m=l.y-(a(this).height()/2);g.call(this,n,m,k[0])},zoomTo:function(l){var k=Math.round((l-this.visible)/(1/this.layerSplit));h.call(this,k)}};return this.each(function(){if(typeof d=="string"){var u=b[d];c.layerSplit=this.layerSplit||c.layerSplit;u.call(this,i)}else{this.visible=c.defaultLayer,this.layerSplit=c.layerSplit;var t=this,o=a(this).find(">div"),s=a(this).height(),q=a(this).width(),p=false,r=true;o.css({position:"absolute"}).eq(c.defaultLayer).css({display:"block",left:"",top:""}).addClass("current-map-layer").find(c.mapContent).css({position:"absolute",left:"0",top:"0",height:s+"px",width:"100%"});o.each(function(){this.defaultWidth=a(this).width();this.defaultHeight=a(this).height();a(this).find(c.mapContent).css({position:"absolute",top:"0",left:"0"});if(a(this).find(c.mapContent).length>0){a(this).find(">img").css({width:"100%",position:"absolute",left:"0",top:"0"}).after('<div class="map-layer-mask"></div>')}});a(this).find(".map-layer-mask").css({position:"absolute",left:"0",top:"0",background:"white",opacity:"0",filter:"alpha(opacity=0)"});if(c.defaultLayer>0){o.eq(c.defaultLayer).find(".map-layer-mask").width(o.eq(c.defaultLayer).width()).height(o.eq(c.defaultLayer).height());o.eq(c.defaultLayer).find(c.mapContent).width(o.eq(c.defaultLayer).width()).height(o.eq(c.defaultLayer).height())}a(this).find(">div:not(.current-map-layer)").hide();if(c.defaultX==null){c.defaultX=Math.floor((q/2)-(a(this).find(".current-map-layer").width()/2));if(c.defaultX>0){c.defaultX=0}}if(c.defaultY==null){c.defaultY=Math.floor((s/2)-(a(this).find(".current-map-layer").height()/2));if(c.defaultY>0){c.defaultY=0}}this.xPos=0-c.defaultX;this.yPos=0-c.defaultY;this.layerSplit=c.layerSplit;var n=c.defaultX;var m=c.defaultY;var l;var k;a(this).find(".current-map-layer").css({left:c.defaultX+"px",top:c.defaultY+"px"});a(this).mousedown(function(){var w=a(this).find(".current-map-layer");var v=w[0].style.left,z=w[0].style.top;v=f(v);z=f(z);c.callBefore(w,v,z,t);p=true;r=true;return false});a(document).mouseup(function(){var w=a(t).find(".current-map-layer");var v=w[0].style.left,z=w[0].style.top;v=f(v);z=f(z);c.callAfter(w,v,z,t);p=false;return false});a(document).mousemove(function(A){var x=a(t).find(".current-map-layer");if(p&&c.pan){if(r){l=A.clientX;k=A.clientY;n=x[0].style.left.replace(/px/,"");m=x[0].style.top.replace(/px/,"");r=false}var z=0,y=0;if(q<x.width()){z=q-x.width()}if(s<x.height()){y=s-x.height()}var w=n-(l-A.clientX);w=(w>0)?0:w;w=(w<z)?z:w;var v=m-(k-A.clientY);v=(v>0)?0:v;v=(v<y)?y:v;x.css({left:w+"px",top:v+"px"});t.xPos=f(x[0].style.left);t.yPos=f(x[0].style.top)}});if(c.mousewheel&&typeof a.fn.mousewheel!="undefined"){a(t).mousewheel(function(v,w){h.call(this,w)});a(this).hover(function(){document.body.style.overflow="hidden"},function(){document.body.style.overflow=null})}a(window).load(function(){o.each(function(){var v=a(this).find("img")[0];if(typeof v=="object"){a("<img>").attr("src",v.src)}})})}})}})(jQuery);